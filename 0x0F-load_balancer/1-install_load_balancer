#!/usr/bin/env bash
#Install and configure HAproxy on your lb-01 server
add-apt-repository ppa:vbernat/haproxy-1.5
apt-get update
apt-get dist-upgrade
apt-get install haproxy
echo "ENABLED=1" >> /etc/default/haproxy
echo
"
defaults
	option forwardfor
	option http-server-close

frontend http
	bind 54.144.197.117:80
	reqadd X-Forwarded-Proto:\ http
	default_backend web_backend

backend web_backend
	balance roundrobin
	server web-01 34.202.158.152:80
	server web-02 100.25.34.22:80
" >> /etc/haproxy/haproxy.cfg
service haproxy restart
